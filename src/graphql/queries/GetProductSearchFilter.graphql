# Consolidated query for product search and filtering
# Returns both products and facets in a single request
# Used after user interaction in single-query mode
# Reduces network overhead by 50% compared to separate queries

query GetProductSearchFilter(
  $phrase: String
  $filter: Citisignal_ProductFilter
  $sort: Citisignal_SortInput
  $limit: Int = 20
  $page: Int = 1
) {
  Citisignal_productSearchFilter(
    phrase: $phrase
    filter: $filter
    sort: $sort
    limit: $limit
    page: $page
  ) {
    # Product results
    products {
      items {
        id
        sku
        urlKey
        name
        manufacturer
        price
        originalPrice
        discountPercent
        inStock
        # Semantic image fields (abstracted from Adobe Commerce roles)
        image {
          url
          altText
        }
        thumbnail {
          url
          altText
        }
        gallery {
          url
          altText
        }
        memory
        colors {
          name
          hex
        }
        # Configurable options for smart button logic
        configurable_options {
          label
          attribute_code
          values {
            label
            value
            swatch_data {
              type
              value
            }
          }
        }
      }
      totalCount
      hasMoreItems
      currentPage
      page_info {
        current_page
        page_size
        total_pages
      }
    }

    # Available facets/filters
    facets {
      facets {
        title
        key
        attributeCode
        type
        options {
          id
          name
          count
        }
      }
      totalCount
    }

    # Overall total
    totalCount
  }
}
